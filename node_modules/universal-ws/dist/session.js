"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const events_1 = require("events");
const retry = require("retry");
const transport_1 = require("./transport");
var transport_2 = require("./transport");
exports.StatusCode = transport_2.StatusCode;
var ReservedPacketTypes;
(function (ReservedPacketTypes) {
    ReservedPacketTypes["Heartbeat"] = "hb";
    ReservedPacketTypes["HeartbeatRequest"] = "hbr";
    ReservedPacketTypes["NegotiateSettings"] = "ns";
})(ReservedPacketTypes || (ReservedPacketTypes = {}));
var PacketType;
(function (PacketType) {
    PacketType[PacketType["Heartbeat"] = 0] = "Heartbeat";
    PacketType[PacketType["Message"] = 1] = "Message";
    PacketType[PacketType["Request"] = 2] = "Request";
    PacketType[PacketType["Response"] = 3] = "Response";
    PacketType[PacketType["Acknowledgement"] = 4] = "Acknowledgement";
    PacketType[PacketType["NegotiateSettings"] = 5] = "NegotiateSettings";
})(PacketType || (PacketType = {}));
var HeartbeatMode;
(function (HeartbeatMode) {
    HeartbeatMode["upstream"] = "upstream";
    HeartbeatMode["downstream"] = "downstream";
    HeartbeatMode["roundtrip"] = "roundtrip";
    HeartbeatMode["disabled"] = "disabled";
})(HeartbeatMode = exports.HeartbeatMode || (exports.HeartbeatMode = {}));
var State;
(function (State) {
    State[State["connecting"] = 0] = "connecting";
    State[State["open"] = 1] = "open";
    State[State["closing"] = 2] = "closing";
    State[State["closed"] = 3] = "closed";
})(State = exports.State || (exports.State = {}));
class Session extends events_1.EventEmitter {
    constructor(host, options, ...parameters) {
        super();
        this.host = host;
        this.waiting = [];
        this.rpcTransactions = {};
        this.connectionTimeout = 60;
        this.responseTimeout = 15;
        this.heartbeatModeTimeoutMultiplier = 2.5;
        this.autoConnect = true;
        this.retryConnectionStatusCodes = [];
        this.heatbeatInterval = 1;
        this.heartbeatMode = HeartbeatMode.roundtrip;
        this.state = State.closed;
        this.messageIdSeed = 0; // rotating id for messages
        if (!options)
            options = {}; // Fill if empty
        if (options.connectionTimeout)
            this.connectionTimeout = options.connectionTimeout;
        if (options.responseTimeout)
            this.responseTimeout = options.responseTimeout;
        if (options.heatbeatInterval)
            this.heatbeatInterval = options.heatbeatInterval;
        if (options.heartbeatMode)
            this.heartbeatMode = options.heartbeatMode;
        if (options.heartbeatModeTimeoutMultiplier)
            this.heartbeatModeTimeoutMultiplier = options.heartbeatModeTimeoutMultiplier;
        if (options.autoConnect)
            this.autoConnect = options.autoConnect;
        if (options.perMessageDeflateOptions)
            this.perMessageDeflateOptions = options.perMessageDeflateOptions;
        if (options.retryConnectionStatusCodes)
            this.retryConnectionStatusCodes = options.retryConnectionStatusCodes;
        this.retryOptions = options.retryOptions ? options.retryOptions : {
            factor: 1.5,
            minTimeout: .5 * 1000,
            maxTimeout: 60 * 1000,
            randomize: true,
            forever: true
        };
        if (parameters && parameters.length)
            this.parameters = parameters;
        if (this.autoConnect) {
            this.resetAndAttemptConnectOperation();
        }
    }
    changeState(state) {
        this.state = state;
        this.emit('state', state);
    }
    resetAndAttemptConnectOperation() {
        if (this.connectOperation) {
            this.connectOperation.stop();
            this.connectOperation.reset();
        }
        this.connectOperation = retry.operation(this.retryOptions);
        this.connectOperation.attempt((currentAttempt) => {
            this.connect();
        }, {
            timeout: this.connectionTimeout * 1000, cb: () => {
                if (this.connectOperation)
                    this.connectOperation.retry(new Error('Connection timed out.'));
            }
        });
    }
    connect() {
        this.transport = new transport_1.UniversalWs(this.host, { parameters: this.parameters, perMessageDeflateOptions: this.perMessageDeflateOptions });
        this.transport.on('message', (data) => {
            this.handleMessage(data);
        });
        this.transport.on('close', (data) => {
            const closeError = this.resolveErrorFromCloseEvent(data);
            if (this.connectOperation) {
                if (closeError)
                    this.connectOperation.retry(closeError);
                else
                    this.connectOperation.stop();
            }
            else {
                if (closeError)
                    this.resetAndAttemptConnectOperation();
                else { } // Do nothing
            }
            this.handleClose(data);
        });
        this.transport.on('error', (data) => {
            this.handleError(data);
        });
        this.transport.on('open', (data) => {
            delete this.connectOperation;
            this.connectionReady();
        });
    }
    connectionReady() {
        this.changeState(State.open);
        this.emit('connected'); // Connected and ready
        if (this.waiting) {
            this.waiting.forEach((callback) => {
                process.nextTick(callback);
            });
            delete this.waiting;
        }
        this.startHeartbeat();
    }
    startHeartbeat() {
        if (this.heartbeatMode === HeartbeatMode.disabled || this.heartbeatMode === HeartbeatMode.downstream)
            return;
        // Clear previous heartbeatPolling if restarting
        if (this.heartbeatPolling)
            clearInterval(this.heartbeatPolling);
        this.heartbeatPolling = setInterval(() => {
            this.heartbeatMode === HeartbeatMode.upstream ? this.sendHeartbeat() : this.requestHeartbeat();
        }, this.heatbeatInterval * 1000);
        this.resetTimeout();
    }
    stopHeartbeat() {
        if (this.expires)
            clearTimeout(this.expires);
        if (this.heartbeatPolling)
            clearInterval(this.heartbeatPolling);
    }
    awaitReady(callback) {
        if (this.state === State.open) {
            process.nextTick(callback);
        }
        else {
            this.waiting = this.waiting || [];
            this.waiting.push(callback);
        }
    }
    resetTimeout() {
        if (this.expires) {
            // Node 10.2.0: this.expires.refresh();
            clearTimeout(this.expires);
            this.expires = setTimeout(() => {
                this.onConnectionInactive();
            }, this.heatbeatInterval * (typeof this.heartbeatModeTimeoutMultiplier === 'number' ? this.heartbeatModeTimeoutMultiplier : this.heartbeatModeTimeoutMultiplier()) * 1000);
        }
        else {
            this.expires = setTimeout(() => {
                this.onConnectionInactive();
            }, this.heatbeatInterval * (typeof this.heartbeatModeTimeoutMultiplier === 'number' ? this.heartbeatModeTimeoutMultiplier : this.heartbeatModeTimeoutMultiplier()) * 1000);
        }
    }
    getPacketType(packet) {
        if (packet.r) { // Handle request/response control
            if (typeof packet.r === 'string') { // Random string indicates a request from the server
                return PacketType.Request;
            }
            else if (typeof packet.r === 'number') { // Incrementing number indicates a response from the server
                return PacketType.Response;
            }
            else {
                return; // Invalid packet
            }
        }
        else if (packet.t) { // Handle Heartbeat & Acknowledgement
            switch (packet.t) {
                case ReservedPacketTypes.Heartbeat: // Server responds to client's heartbeat request
                    return PacketType.Heartbeat;
                case ReservedPacketTypes.NegotiateSettings: // Server responds to client's negotiate settings
                    return PacketType.NegotiateSettings;
                default: // Server acknowledges a response from the client
                    return PacketType.Acknowledgement;
            }
        }
        else { // Handle simple messages from the client
            return PacketType.Message; // Simple message from the client
        }
    }
    handleClose(data) {
        this.transport = undefined;
        // Callback all existing rpc's with an error
        Object.keys(this.rpcTransactions).forEach((transactionId) => {
            this.rpcTransactions[transactionId].callback(undefined, 'Connection closed');
        });
        this.onConnectionInactive({ code: data.code, reason: data.reason });
    }
    // Returns an error and the client will retry to connect
    resolveErrorFromCloseEvent(data) {
        switch (data.code) {
            case transport_1.StatusCode.Normal_Closure:
            case transport_1.StatusCode.Going_Away:
            case transport_1.StatusCode.Protocol_Error:
            case transport_1.StatusCode.No_Status_Code_Present:
                return;
            case transport_1.StatusCode.Invalid_Data:
                // Retry on 1006
                return new Error('Connection was closed abnormally. Possibly server unreachable');
            case transport_1.StatusCode.Message_Error:
            case transport_1.StatusCode.Unexpected_Error:
                // Do not reconnect, unknown server error
                return;
            case undefined:
                // Code not recieved
                this.handleError(new Error(`No status code recieved on server close: ${data.code}`));
                return;
            default:
                if (this.retryConnectionStatusCodes.includes(data.code))
                    return new Error(`Retrying connection on custom status code: ${data.code}`);
                this.handleError(new Error(`Unknown status code recieved on server close: ${data.code}`));
                return;
        }
    }
    handleError(data) {
        this.emit('error', data);
    }
    handleMessage(message) {
        this.onConnectionActive();
        if (!message)
            return;
        this.awaitReady(() => {
            let packet;
            // parse packet JSON
            try {
                packet = JSON.parse(message);
            }
            catch (error) {
                // throw?
                throw new Error('Invalid packet');
            }
            switch (this.getPacketType(packet)) {
                case PacketType.Heartbeat: // Heartbeat handled by onConnectionActive
                    break;
                case PacketType.NegotiateSettings:
                    this.onNegotiateSettings(packet);
                    break;
                case PacketType.Message: // Message from the server
                    this.onMessage(packet);
                    break;
                case PacketType.Request: // Request from the server expecting a response from client
                    this.onRequest(packet);
                    break;
                case PacketType.Response: // Response from the server for a previous request
                    this.onResponse(packet);
                    break;
                case PacketType.Acknowledgement: // Acknowledgement from server of a response from client
                    this.onAcknowledgement(packet);
                    break;
                default:
                    throw new Error('Invalid packet');
            }
        });
    }
    // Called whenever connection is active
    onConnectionActive() {
        if (this.state === State.open) {
            this.resetTimeout();
        }
    }
    // Called when the connection is considered inactive
    onConnectionInactive(data) {
        this.changeState(State.closing);
        this.stopHeartbeat();
        if (data) {
            this.emit('disconnected', data.code, data.reason);
        }
        else {
            this.emit('disconnected');
        }
    }
    onNegotiateSettings(packet) {
        // Handle negotiate expecting approval response
        if (this.rpcTransactions[packet.d.id]) {
            if (packet.t) { // Client expects acknowledgement of response
                if (this.transport)
                    this.transport.send(JSON.stringify({ t: packet.t }));
            }
            this.rpcTransactions[packet.d.id].callback(packet.d);
        }
    }
    onMessage(packet) {
        this.emit('message', `#${packet.m}`, packet.d);
    }
    onRequest(packet) {
        // Handle request expecting a response
        const callback = (data, ack) => {
            const response = {
                m: JSON.stringify(packet.m),
                d: data,
                r: JSON.stringify(packet.i)
            };
            if (ack) {
                return new Promise((resolve, reject) => {
                    const acknowledgementId = this.getNextMessageId().toString();
                    response.t = acknowledgementId;
                    this.rpcTransactions[acknowledgementId] = {
                        callback: (response, error) => {
                            // Clear and delete rpc
                            clearTimeout(this.rpcTransactions[acknowledgementId].timer);
                            delete this.rpcTransactions[acknowledgementId];
                            error ? reject(error) : resolve();
                        },
                        timer: setTimeout(() => {
                            // Timed out in acknowledging response
                            this.rpcTransactions[acknowledgementId].callback(undefined, 'Acknowledgement timed out');
                        }, this.responseTimeout * 1000)
                    };
                    if (this.transport)
                        this.transport.send(JSON.stringify(response));
                });
            }
            else {
                if (this.transport)
                    this.transport.send(JSON.stringify(response));
                return;
            }
        };
        this.emit('request', `@${packet.m}`, packet.d, callback);
    }
    onResponse(packet) {
        if (typeof packet.r !== 'number')
            return;
        if (this.rpcTransactions[packet.r]) {
            if (packet.t) { // Client expects acknowledgement of response
                if (this.transport)
                    this.transport.send(JSON.stringify({ t: packet.t }));
            }
            this.rpcTransactions[packet.r].callback(packet.d);
        }
    }
    onAcknowledgement(packet) {
        if (typeof packet.t !== 'string')
            return;
        if (this.rpcTransactions[packet.t]) {
            this.rpcTransactions[packet.t].callback(undefined);
        }
    }
    sendHeartbeat() {
        if (this.transport)
            this.transport.send(JSON.stringify({ t: ReservedPacketTypes.Heartbeat }));
    }
    requestHeartbeat() {
        if (this.transport)
            this.transport.send(JSON.stringify({ t: ReservedPacketTypes.HeartbeatRequest }));
    }
    getNextMessageId() {
        if (this.messageIdSeed === Number.MAX_SAFE_INTEGER)
            this.messageIdSeed = 0; // Reset to 0
        return ++this.messageIdSeed;
    }
    negotiate(settings) {
        return new Promise((resolve, reject) => {
            const packet = {
                t: ReservedPacketTypes.NegotiateSettings,
                d: settings
            };
            this.awaitReady(() => {
                const negotiationId = this.getNextMessageId().toString();
                this.rpcTransactions[negotiationId] = {
                    callback: (response, error) => {
                        // Clear and delete rpc
                        clearTimeout(this.rpcTransactions[negotiationId].timer);
                        delete this.rpcTransactions[negotiationId];
                        error ? reject(error) : resolve({ approve: response.approve, supportedOptions: response.supportedOptions });
                    },
                    timer: setTimeout(() => {
                        this.rpcTransactions[negotiationId].callback(undefined, new Error('Negotiation timed out.'));
                    }, this.responseTimeout * 1000)
                };
                if (this.transport)
                    this.transport.send(JSON.stringify(packet));
            });
        });
    }
    send(message, data) {
        const packet = {
            m: message
        };
        if (data) {
            packet.d = data;
        }
        this.awaitReady(() => {
            if (this.transport)
                this.transport.send(JSON.stringify(packet));
        });
    }
    sendWithAck(message, data) {
        return new Promise((resolve, reject) => {
            const packet = {
                m: message
            };
            if (data) {
                packet.d = data;
            }
            this.awaitReady(() => {
                const acknowledgementId = this.getNextMessageId().toString();
                packet.i = acknowledgementId;
                this.rpcTransactions[acknowledgementId] = {
                    callback: (response, error) => {
                        // Clear and delete rpc
                        clearTimeout(this.rpcTransactions[acknowledgementId].timer);
                        delete this.rpcTransactions[acknowledgementId];
                        error ? reject(error) : resolve();
                    },
                    timer: setTimeout(() => {
                        this.rpcTransactions[acknowledgementId].callback(undefined, new Error('Acknowledgement timed out.'));
                    }, this.responseTimeout * 1000)
                };
                if (this.transport)
                    this.transport.send(JSON.stringify(packet));
            });
        });
    }
    request(message, data = {}) {
        return new Promise((resolve, reject) => {
            const requestId = this.getNextMessageId();
            const packet = {
                m: message,
                d: data,
                r: requestId
            };
            this.awaitReady(() => {
                if (this.transport) {
                    this.transport.send(JSON.stringify(packet));
                    this.rpcTransactions[requestId] = {
                        callback: (response, error) => {
                            // Clear and delete rpc
                            clearTimeout(this.rpcTransactions[requestId].timer);
                            delete this.rpcTransactions[requestId];
                            error ? reject(error) : resolve(response);
                        },
                        timer: setTimeout(() => {
                            // Timed out in acknowledging response
                            this.rpcTransactions[requestId].callback(undefined, new Error('Response timed out.'));
                        }, this.responseTimeout * 1000)
                    };
                }
            });
        });
    }
    close(code, reason) {
        this.changeState(State.closing);
        delete this.connectOperation;
        if (this.transport)
            this.transport.close(code, reason);
        // Clean up events
        this.changeState(State.closed);
        this.stopHeartbeat();
        Object.keys(this.rpcTransactions).forEach((transactionId) => {
            this.rpcTransactions[transactionId].callback(undefined, 'Connection closed');
        });
    }
    open() {
        if (this.state === State.closed) {
            this.connect();
            return;
        }
        else {
            return new Error(`Cannot open. Current state is: ${this.state}`);
        }
    }
}
exports.Session = Session;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Vzc2lvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXNzaW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbUNBQXNDO0FBQ3RDLCtCQUErQjtBQUMvQiwyQ0FBbUU7QUFHbkUseUNBQXlDO0FBQWhDLGlDQUFBLFVBQVUsQ0FBQTtBQUVuQixJQUFLLG1CQUlKO0FBSkQsV0FBSyxtQkFBbUI7SUFDcEIsdUNBQWdCLENBQUE7SUFDaEIsK0NBQXdCLENBQUE7SUFDeEIsK0NBQXdCLENBQUE7QUFDNUIsQ0FBQyxFQUpJLG1CQUFtQixLQUFuQixtQkFBbUIsUUFJdkI7QUFnQkQsSUFBSyxVQU9KO0FBUEQsV0FBSyxVQUFVO0lBQ1gscURBQVMsQ0FBQTtJQUNULGlEQUFPLENBQUE7SUFDUCxpREFBTyxDQUFBO0lBQ1AsbURBQVEsQ0FBQTtJQUNSLGlFQUFlLENBQUE7SUFDZixxRUFBaUIsQ0FBQTtBQUNyQixDQUFDLEVBUEksVUFBVSxLQUFWLFVBQVUsUUFPZDtBQUVELElBQVksYUFLWDtBQUxELFdBQVksYUFBYTtJQUNyQixzQ0FBcUIsQ0FBQTtJQUNyQiwwQ0FBeUIsQ0FBQTtJQUN6Qix3Q0FBdUIsQ0FBQTtJQUN2QixzQ0FBcUIsQ0FBQTtBQUN6QixDQUFDLEVBTFcsYUFBYSxHQUFiLHFCQUFhLEtBQWIscUJBQWEsUUFLeEI7QUFFRCxJQUFZLEtBS1g7QUFMRCxXQUFZLEtBQUs7SUFDYiw2Q0FBVSxDQUFBO0lBQ1YsaUNBQUksQ0FBQTtJQUNKLHVDQUFPLENBQUE7SUFDUCxxQ0FBTSxDQUFBO0FBQ1YsQ0FBQyxFQUxXLEtBQUssR0FBTCxhQUFLLEtBQUwsYUFBSyxRQUtoQjtBQWNELE1BQWEsT0FBUSxTQUFRLHFCQUFZO0lBeUJyQyxZQUFvQixJQUFZLEVBQUUsT0FBMkIsRUFBRSxHQUFHLFVBQW9CO1FBQ2xGLEtBQUssRUFBRSxDQUFDO1FBRFEsU0FBSSxHQUFKLElBQUksQ0FBUTtRQXJCeEIsWUFBTyxHQUFvQixF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